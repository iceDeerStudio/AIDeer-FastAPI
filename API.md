# AIDeer API 文档

本文档仅提供了简要的接口信息。建议启动服务后，访问 `/docs` 查看接口文档，Swagger 文档提供了更加详细的接口信息和参数说明。

## 0. 响应状态码

### `200`: 成功响应。

- 请求成功。
- 将返回请求的数据。

### `400`: 请求错误。

- 请求参数错误。
- 请检查请求参数是否符合要求。

### `401`: 未授权。需要登录。

- 未登录。
- 需要登录并携带访问令牌。

### `402`: 积分不足。

- 积分不足。
- 需要用户充值或使用兑换码。

### `403`: 权限不足。

### `404`: 未找到资源。

### `422`: 数据验证错误。

- 数据验证错误。这通常是由于请求体或参数不符合要求。
- 请检查请求体或参数是否符合 Schema 中的定义。

### `500`: 服务器内部错误。

- 服务器内部错误。这通常是由于服务器代码错误。
- 请联系后端开发人员解决问题。

## 1. 用户管理

### 列出用户 [GET /api/v1/users]

- **描述**: 获取用户列表。
- **安全**: 使用 Access Token 授权，需要管理员权限。
- **参数**:
  - `offset` (可选): 查询偏移量，默认为 0。
  - `limit` (可选): 限制返回数量，默认为 10。
- **响应**:
  - `200`: 成功响应，返回用户列表。
  - `401`: 未授权。需要登录。
  - `403`: 权限不足。

### 创建用户 [POST /api/v1/users]

- **描述**: 创建新用户。
- **安全**: 使用 Access Token 授权。
- **请求体**: 包含用户创建信息。
- **响应**:
  - `200`: 成功响应，返回创建的用户信息。
  - `400`: 请求错误。
  - `403`: 权限不足。
  - `422`: 数据验证错误。

### 获取当前用户信息 [GET /api/v1/users/me]

- **描述**: 获取当前登录用户的信息。
- **安全**: 使用 Access Token 授权。
- **响应**:
  - `200`: 成功响应，返回用户信息。
  - `401`: 未授权。需要登录。

### 更新当前用户密码 [PUT /api/v1/users/me/password]

- **描述**: 更新当前用户的密码。
- **安全**: 使用 Access Token 授权。
- **请求体**: 包含新旧密码信息。
- **响应**:
  - `200`: 成功响应。
  - `400`: 请求错误。
  - `401`: 未授权。需要登录。
  - `404`: 未找到。
  - `422`: 数据验证错误。

### 获取当前用户头像 [GET /api/v1/users/me/avatar]

- **描述**: 获取当前用户的头像。
- **安全**: 使用 Access Token 授权。
- **响应**:
  - `307`: 成功响应。
  - `401`: 未授权。需要登录。

### 设置当前用户头像 [POST /api/v1/users/me/avatar]

- **描述**: 上传并设置当前用户的头像。
- **安全**: 使用 Access Token 授权。
- **请求体**: 包含头像文件。
- **响应**:
  - `200`: 成功响应。
  - `401`: 未授权。需要登录。
  - `404`: 未找到。
  - `422`: 数据验证错误。

### 获取用户积分 [GET /api/v1/users/me/credits]

- **描述**: 获取当前用户的积分记录。
- **安全**: 使用 Access Token 授权。
- **响应**:
  - `200`: 成功响应，返回积分记录。
  - `401`: 未授权。需要登录。

### 兑换积分 [POST /api/v1/users/me/credits]

- **描述**: 用户使用兑换码兑换积分。
- **安全**: 使用 Access Token 授权。
- **请求体**: 包含兑换码信息。
- **响应**:
  - `200`: 成功响应。
  - `401`: 未授权。需要登录。
  - `422`: 数据验证错误。

### 读取用户信息 [GET /api/v1/users/{user_id}]

- **描述**: 根据用户 ID 获取用户信息。
- **安全**: 使用 Access Token 授权。
- **参数**:
  - `user_id` (必填): 用户 ID。
- **响应**:
  - `200`: 成功响应，返回用户信息。
  - `401`: 未授权。需要登录。
  - `404`: 未找到。
  - `422`: 数据验证错误。

### 更新用户信息 [PUT /api/v1/users/{user_id}]

- **描述**: 根据用户 ID 更新用户信息。
- **安全**: 使用 Access Token 授权。
- **参数**:
  - `user_id` (必填): 用户 ID。
- **请求体**: 包含更新后的用户信息。
- **响应**:
  - `200`: 成功响应，返回更新后的用户信息。
  - `400`: 请求错误。
  - `401`: 未授权。需要登录。
  - `403`: 权限不足。
  - `404`: 未找到。
  - `422`: 数据验证错误。

### 删除用户 [DELETE /api/v1/users/{user_id}]

- **描述**: 根据用户 ID 删除用户。
- **安全**: 使用 Access Token 授权，需要管理员权限。
- **参数**:
  - `user_id` (必填): 用户 ID。
- **响应**:
  - `200`: 成功响应。
  - `401`: 未授权。需要登录。
  - `403`: 权限不足。
  - `404`: 未找到。
  - `422`: 数据验证错误。

### 重置用户密码 [PUT /api/v1/users/{user_id}/password]

- **描述**: 根据用户 ID 重置用户密码。
- **安全**: 使用 Access Token 授权，需要管理员权限。
- **参数**:
  - `user_id` (必填): 用户 ID。
- **请求体**: 包含新密码信息。
- **响应**:
  - `200`: 成功响应。
  - `401`: 未授权。需要登录。
  - `403`: 权限不足。
  - `404`: 未找到。
  - `422`: 数据验证错误。

### 获取用户头像 [GET /api/v1/users/{user_id}/avatar]

- **描述**: 根据用户 ID 获取用户头像。
- **安全**: 使用 Access Token 授权。
- **参数**:
  - `user_id` (必填): 用户 ID。
- **响应**:
  - `307`: 成功响应。
  - `401`: 未授权。需要登录。
  - `404`: 未找到。
  - `422`: 数据验证错误。

## 2. 会话管理

### 登录获取访问令牌 [POST /api/v1/session/oauth2/token]

- **描述**: 用户登录并获取访问令牌。
- **请求体**: 包含登录凭证。
- **响应**:
  - `200`: 成功响应，返回访问令牌。
  - `401`: 未授权。需要登录。
  - `422`: 数据验证错误。

### 微信登录获取令牌 [GET /api/v1/session/wechat/token]

- **描述**: 通过微信登录获取令牌。
- **参数**:
  - `code` (必填): 微信登录码。
- **响应**:
  - `200`: 成功响应，返回令牌。
  - `401`: 未授权。需要登录。
  - `500`: 服务器内部错误。
  - `422`: 数据验证错误。

### 微信刷新访问令牌 [GET /api/v1/session/wechat/refresh]

- **描述**: 通过微信刷新访问令牌。
- **安全**: 使用 Refresh Token 授权。
- **响应**:
  - `200`: 成功响应，返回刷新后的令牌。
  - `401`: 未授权。需要登录。

## 3. 聊天管理

### 列出聊天 [GET /api/v1/chats]

- **描述**: 获取聊天列表。
- **安全**: 使用 Access Token 授权。
- **参数**:
  - `offset` (可选): 查询偏移量，默认为 0。
  - `limit` (可选): 限制返回数量，默认为 10。
- **响应**:
  - `200`: 成功响应，返回聊天列表。
  - `401`: 未授权。需要登录。
  - `403`: 权限不足。
  - `422`: 数据验证错误。

### 创建聊天 [POST /api/v1/chats]

- **描述**: 创建新的聊天。
- **安全**: 使用 Access Token 授权。
- **请求体**: 包含聊天创建信息。
- **响应**:
  - `200`: 成功响应，返回创建的聊天信息。
  - `401`: 未授权。需要登录。
  - `403`: 权限不足。
  - `422`: 数据验证错误。

### 读取聊天信息 [GET /api/v1/chats/{chat_id}]

- **描述**: 根据聊天 ID 获取聊天信息。
- **安全**: 使用 Access Token 授权。
- **参数**:
  - `chat_id` (必填): 聊天 ID。
- **响应**:
  - `200`: 成功响应，返回聊天信息。
  - `401`: 未授权。需要登录。
  - `403`: 权限不足。
  - `404`: 未找到。
  - `422`: 数据验证错误。

### 更新聊天信息 [PUT /api/v1/chats/{chat_id}]

- **描述**: 根据聊天 ID 更新聊天信息。
- **安全**: 使用 Access Token 授权。
- **参数**:
  - `chat_id` (必填): 聊天 ID。
- **请求体**: 包含更新后的聊天信息。
- **响应**:
  - `200`: 成功响应，返回更新后的聊天信息。
  - `401`: 未授权。需要登录。
  - `403`: 权限不足。
  - `404`: 未找到。
  - `422`: 数据验证错误。

### 删除聊天 [DELETE /api/v1/chats/{chat_id}]

- **描述**: 根据聊天 ID 删除聊天。
- **安全**: 使用 Access Token 授权。
- **参数**:
  - `chat_id` (必填): 聊天 ID。
- **响应**:
  - `200`: 成功响应。
  - `401`: 未授权。需要登录。
  - `403`: 权限不足。
  - `404`: 未找到。
  - `422`: 数据验证错误。

## 4. 预设管理

### 列出预设 [GET /api/v1/presets]

- **描述**: 获取预设列表。
- **安全**: 使用 Access Token 授权。
- **参数**:
  - `offset` (可选): 查询偏移量，默认为 0。
  - `limit` (可选): 限制返回数量，默认为 10。
- **响应**:
  - `200`: 成功响应，返回预设列表。
  - `401`: 未授权。需要登录。
  - `422`: 数据验证错误。

### 创建预设 [POST /api/v1/presets]

- **描述**: 创建新的预设。
- **安全**: 使用 Access Token 授权。
- **请求体**: 包含预设创建信息。
- **响应**:
  - `200`: 成功响应，返回创建的预设信息。
  - `401`: 未授权。需要登录。
  - `403`: 权限不足。
  - `422`: 数据验证错误。

### 读取预设信息 [GET /api/v1/presets/{preset_id}]

- **描述**: 根据预设 ID 获取预设信息。
- **安全**: 使用 Access Token 授权。
- **参数**:
  - `preset_id` (必填): 预设 ID。
- **响应**:
  - `200`: 成功响应，返回预设信息。
  - `401`: 未授权。需要登录。
  - `403`: 权限不足。
  - `404`: 未找到。
  - `422`: 数据验证错误。

### 更新预设信息 [PUT /api/v1/presets/{preset_id}]

- **描述**: 根据预设 ID 更新预设信息。
- **安全**: 使用 Access Token 授权。
- **参数**:
  - `preset_id` (必填): 预设 ID。
- **请求体**: 包含更新后的预设信息。
- **响应**:
  - `200`: 成功响应，返回更新后的预设信息。
  - `401`: 未授权。需要登录。
  - `403`: 权限不足。
  - `404`: 未找到。
  - `422`: 数据验证错误。

### 删除预设 [DELETE /api/v1/presets/{preset_id}]

- **描述**: 根据预设 ID 删除预设。
- **安全**: 使用 Access Token 授权。
- **参数**:
  - `preset_id` (必填): 预设 ID。
- **响应**:
  - `200`: 成功响应。
  - `401`: 未授权。需要登录。
  - `403`: 权限不足。
  - `404`: 未找到。
  - `422`: 数据验证错误。

## 5. 兑换码管理

### 读取兑换码 [GET /api/v1/codes/{code}]

- **描述**: 根据兑换码获取兑换信息。
- **参数**:
  - `code` (必填): 兑换码。
- **响应**:
  - `200`: 成功响应，返回兑换码信息。
  - `422`: 无法处理的实体。

### 删除兑换码 [DELETE /api/v1/codes/{code}]

- **描述**: 根据兑换码删除兑换记录。
- **安全**: 使用 Access Token 授权。
- **参数**:
  - `code` (必填): 兑换码。
- **响应**:
  - `200`: 成功响应。
  - `401`: 未授权。需要登录。
  - `403`: 权限不足。
  - `422`: 数据验证错误。

### 创建兑换码 [POST /api/v1/codes]

- **描述**: 创建新的兑换码。
- **安全**: 使用 Access Token 授权。
- **请求体**: 包含兑换码信息。
- **响应**:
  - `200`: 成功响应，返回创建的兑换码信息。
  - `401`: 未授权。需要登录。
  - `403`: 权限不足。
  - `422`: 数据验证错误。

## 6. 任务管理

### 创建任务 [POST /api/v1/tasks]

- **描述**: 创建新的任务。
- **安全**: 使用 Access Token 授权。
- **请求体**: 包含任务创建信息。
- **响应**:
  - `200`: 成功响应，返回创建的任务信息。
  - `401`: 未授权。需要登录。
  - `402`: 积分不足。
  - `403`: 权限不足。
  - `404`: 未找到。
  - `422`: 数据验证错误。

### 读取任务信息 [GET /api/v1/tasks/{task_id}]

- **描述**: 根据任务 ID 获取任务信息。
- **参数**:
  - `task_id` (必填): 任务 ID。
- **响应**:
  - `200`: 成功响应，返回任务信息。
  - `404`: 未找到。
  - `422`: 数据验证错误。

### 删除任务 [DELETE /api/v1/tasks/{task_id}]

- **描述**: 根据任务 ID 删除任务。只允许删除已完成或已失败的任务。
- **参数**:
  - `task_id` (必填): 任务 ID。
- **响应**:
  - `200`: 成功响应。
  - `404`: 未找到。
  - `422`: 数据验证错误。

### 任务流 [GET /api/v1/tasks/{task_id}/stream]

- **描述**: 获取任务的实时流数据。该接口每个任务只能有一个连接，多次连接则会返回 422 错误。
- **参数**:
  - `task_id` (必填): 任务 ID。
- **响应**:
  - `200`: 成功响应。
  - `422`: 无法处理的实体。

## 7. 实用工具

实用工具接口仅在测试环境 `DEBUG=True` 时可用。

### 初始化 [GET /api/v1/utils/init]

- **描述**: 初始化操作。
- **响应**:
  - `200`: 成功响应。

### 创建管理员 [GET /api/v1/utils/admin]

- **描述**: 创建管理员账户。
- **响应**:
  - `200`: 成功响应，返回管理员用户信息。
  - `400`: 请求错误。
  - `500`: 服务器内部错误。

### 数据库清空 [GET /api/v1/utils/drop]

- **描述**: 清空数据库。
- **响应**:
  - `200`: 成功响应。
